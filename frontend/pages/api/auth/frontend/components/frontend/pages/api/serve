import type { NextApiRequest, NextApiResponse } from "next";
import axios from "axios";

/*
  This endpoint proxies server stats.
  You can either:
  - Have your Discord bot expose a REST endpoint at BOT_API_URL/guild/:id/stats
  - Or use the Discord API with a bot token (not recommended in frontend)
*/

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const BOT_API = process.env.BOT_API_URL;
  const GUILD_ID = process.env.DISCORD_GUILD_ID;
  if (!BOT_API || !GUILD_ID) return res.status(500).json({ error: "Server not configured" });

  try {
    const response = await axios.get(`${BOT_API}/guild/${GUILD_ID}/stats`);
    return res.status(200).json(response.data);
  } catch (err) {
    console.error(err);
    return res.status(502).json({ error: "Failed to fetch stats from bot API" });
  }
}
